# Cerebro Crypto

> A professional-grade cryptocurrency trading terminal built with React + Express, powered by the Coinbase Advanced Trade API.

*Generated by **DoogieHowser** | Last updated: 2026-02-20 — HYDRA unified strategy engine*

---

## Table of Contents

- [Overview](#overview)
- [Tech Stack](#tech-stack)
- [Architecture](#architecture)
- [File Map](#file-map)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
  - [Environment Variables](#environment-variables)
  - [Running the Project](#running-the-project)
  - [Building for Production](#building-for-production)
- [API Reference](#api-reference)
  - [Proxy Server Endpoints](#proxy-server-endpoints)
  - [Coinbase REST Proxy](#coinbase-rest-proxy)
  - [WebSocket Channels](#websocket-channels)
- [Authentication & Security](#authentication--security)
  - [JWT Signing (Ed25519 / ES256)](#jwt-signing-ed25519--es256)
  - [WebSocket Authentication](#websocket-authentication)
  - [HMAC Fallback (Legacy)](#hmac-fallback-legacy)
- [Key Modules & Components](#key-modules--components)
  - [Store (Zustand)](#store-zustand)
  - [Services](#services)
  - [Custom Hooks](#custom-hooks)
  - [UI Components](#ui-components)
  - [Web Workers](#web-workers)
  - [Utilities](#utilities)
- [Paper Trading](#paper-trading)
- [Indicator Engine](#indicator-engine)
- [Chart Mechanisms](#chart-mechanisms)
  - [Architecture Overview](#chart-architecture-overview)
  - [Canvas Creation & Lifecycle](#canvas-creation--lifecycle)
  - [Safety Mechanisms](#safety-mechanisms)
  - [Main Chart Drawing Pipeline](#main-chart-drawing-pipeline)
  - [Lower Indicator Panel](#lower-indicator-panel)
  - [View State & Interaction](#view-state--interaction)
  - [Data Flow: WebSocket to Pixels](#data-flow-websocket-to-pixels)
  - [Resize Handling](#resize-handling)
  - [Indicator Overlay System](#indicator-overlay-system)
  - [Formatting Functions](#formatting-functions)
  - [CSS Layout](#chart-css-layout)
  - [Known Issue: recentTrades Ticker](#known-issue-recenttrades-ticker)
- [Strategy & Regime Detection](#strategy--regime-detection)
- [Risk Management](#risk-management)
- [Backtesting](#backtesting)
- [Scalp Dashboard](#scalp-dashboard)
- [Database & Persistence](#database--persistence)
- [Configuration](#configuration)
- [Color Palette & Theming](#color-palette--theming)
- [Dependency Graph](#dependency-graph)
- [Security Notes](#security-notes)
- [TODOs & Known Issues](#todos--known-issues)
- [Troubleshooting](#troubleshooting)
- [Changelog](#changelog)

---

## Overview

Cerebro Crypto is a full-featured cryptocurrency trading terminal designed for active traders. It connects to the **Coinbase Advanced Trade API** for real-time market data and order execution, with a built-in paper trading simulator for risk-free practice.

**Key capabilities:**
- Real-time candlestick charts with custom HTML5 Canvas rendering
- Live WebSocket price feeds for 18 trading pairs
- Paper trading with $25,000 simulated balance
- Live trading with Coinbase account (Ed25519 JWT authentication)
- Technical indicators computed off-thread via Web Workers (EMA, RSI, MACD, Bollinger Bands, ATR, ADX, VWAP)
- Automated stop-loss / take-profit execution with trailing stops
- Market regime detection (Bullish / Choppy / Bearish)
- HYDRA unified strategy engine — 5-dimensional confluence scoring with self-calibrating thresholds
- Scalp Dashboard with spread monitoring, trade flow analysis, and fee impact calculations
- Backtesting engine with equity curve visualization
- AI Assistant integration (Claude / OpenAI)
- Alert system for price and indicator conditions
- In-app User Guide with search
- Configurable indicator picker with preset management
- Trade log with export to CSV/JSON
- IndexedDB caching for offline candle data

---

## Tech Stack

| Category | Technology | Version |
|----------|-----------|---------|
| **Frontend** | React | ^18.3.1 |
| **Build Tool** | Vite | ^5.4.10 |
| **State Management** | Zustand | ^4.5.5 |
| **HTTP Client** | Axios | ^1.7.7 |
| **Virtualized Lists** | react-window | ^1.8.10 |
| **Browser Storage** | idb (IndexedDB) | ^8.0.0 |
| **Backend** | Express | ^4.21.0 |
| **WebSocket** | ws | ^8.18.0 |
| **Authentication** | jsonwebtoken + node:crypto | ^9.0.2 |
| **CORS** | cors | ^2.8.5 |
| **Environment** | dotenv | ^16.4.5 |
| **Process Runner** | concurrently | ^9.0.1 |
| **Styling** | Vanilla CSS with CSS Variables | — |
| **Font** | Inter (Google Fonts) | 400–800 |
| **Module System** | ES Modules | — |

---

## Architecture

```
┌───────────────────────────────────────────────────────────────┐
│                     Browser (Port 3001)                       │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                 React Application                       │  │
│  │                                                         │  │
│  │  ┌──────────┐  ┌──────────┐  ┌────────────────────┐    │  │
│  │  │ TopBar   │  │ Chart    │  │ OrderEntry         │    │  │
│  │  │ Watchlist │  │ Hydra    │  │ Positions          │    │  │
│  │  │ OrderBook│  │ Controls │  │ TradeLog           │    │  │
│  │  └──────────┘  └──────────┘  │ AIAssistant        │    │  │
│  │                              └────────────────────┘    │  │
│  │  ┌──────────────────────────────────────────────────┐  │  │
│  │  │  Bottom Tabs: Backtest │ Alerts │ Scalp │ Guide  │  │  │
│  │  └──────────────────────────────────────────────────┘  │  │
│  │                                                         │  │
│  │  ┌───────────────────── Zustand Store ───────────────┐  │  │
│  │  │  tickers │ candles │ indicators │ positions │ ... │  │  │
│  │  └───────────────────────────────────────────────────┘  │  │
│  │                                                         │  │
│  │  ┌────────────────┐  ┌─────────────────────────────┐    │  │
│  │  │  Web Workers   │  │  IndexedDB + localStorage   │    │  │
│  │  │  • indicators  │  │  • candle cache             │    │  │
│  │  │  • backtest    │  │  • trades, paper trades     │    │  │
│  │  └────────────────┘  │  • settings, watchlist      │    │  │
│  │                      └─────────────────────────────┘    │  │
│  └─────────────────────────────────────────────────────────┘  │
│                          │  /api proxy                        │
└──────────────────────────┼────────────────────────────────────┘
                           ▼
┌───────────────────────────────────────────────────────────────┐
│              Express Proxy Server (Port 3002)                 │
│                                                               │
│  • Ed25519 / ES256 JWT signing                                │
│  • Paper trading order simulation                             │
│  • Price caching for paper fills                              │
│  • HMAC fallback for legacy keys                              │
└──────────────────────────┬────────────────────────────────────┘
                           │
                           ▼
┌───────────────────────────────────────────────────────────────┐
│                    Coinbase Advanced Trade                     │
│                                                               │
│  REST:  api.coinbase.com/api/v3/brokerage/*                   │
│  WS:    wss://advanced-trade-ws.coinbase.com                  │
└───────────────────────────────────────────────────────────────┘
```

**Data flow:**
1. **WebSocket** → `useCoinbaseWebSocket` hook → Zustand store → Components
2. **REST** → `useCoinbaseREST` hook → Zustand store (with IndexedDB cache)
3. **Indicators** → Store candle updates → Web Worker → Store indicator updates → Chart
4. **Orders** → `useOrders` hook → Proxy server → Coinbase API (live) or Paper simulator
5. **Regime** → 5s polling → Worker classification → Store regime + alert log

---

## File Map

```
cerebro-crypto/
├── .env                        # API credentials (not versioned)
├── .env.example                # Template for environment variables
├── .gitignore                  # Git exclusions
├── index.html                  # HTML entry point (loads Inter font, mounts React)
├── package.json                # Dependencies and scripts
├── vite.config.js              # Vite config: React plugin, port 3001, /api proxy
│
├── server/
│   └── proxy.js                # Express proxy: JWT auth, paper trading, API forwarding
│
└── src/
    ├── main.jsx                # React entry point with ErrorBoundary
    ├── App.jsx                 # Root layout: CSS Grid with 3-column design + bottom tabs
    ├── App.css                 # Grid layout, modals, responsive breakpoints
    ├── index.css               # CSS variables, reset, scrollbar, typography
    │
    ├── config/
    │   ├── constants.js        # Trading pairs, timeframes, risk defaults, colors, WS URL
    │   ├── indicatorDefaults.js# Default indicator periods and display colors
    │   └── tickerProfiles.js   # Per-pair config (decimal places, min order size)
    │
    ├── db/
    │   └── indexedDB.js        # IndexedDB wrapper: trades, candles, paper trades, alerts
    │
    ├── store/
    │   └── index.js            # Zustand global store with localStorage persistence
    │
    ├── services/
    │   ├── coinbaseREST.js     # Axios client: products, candles, orders, accounts
    │   ├── coinbaseWebSocket.js# Singleton WS manager: subscribe, reconnect, heartbeat
    │   └── aiService.js        # AI chat proxy (Claude / OpenAI)
    │
    ├── hooks/
    │   ├── useMarketData.js    # Orchestrator: fetches candles, starts WS, calculates indicators
    │   ├── useCoinbaseWebSocket.js # WS lifecycle, channel subscriptions, store routing
    │   ├── useCoinbaseREST.js  # REST with loading states, IndexedDB caching
    │   ├── useOrders.js        # Order submission, risk validation, paper simulation
    │   ├── usePositions.js     # Open positions, real-time P&L, SL/TP execution
    │   ├── usePaperTrading.js  # Paper balance, positions, trades, equity tracking
    │   ├── useBacktest.js      # Backtest worker management, progress tracking
    │   └── useRegimeDetection.js # Market regime polling every 5 seconds
    │
    ├── workers/
    │   ├── indicators.worker.js# Off-thread: EMA, RSI, MACD, BB, ATR, ADX, VWAP, regime
    │   └── backtest.worker.js  # Off-thread: backtesting engine with strategy replay
    │
    ├── utils/
    │   ├── indicators.js       # Pure functions: SMA, EMA, RSI, MACD, BB, ATR, ADX, VWAP
    │   ├── riskManager.js      # Position sizing, SL/TP calculation, order validation
    │   ├── paperSimulator.js   # Paper fill simulation with slippage and fees
    │   ├── regimeDetector.js   # Bullish/Choppy/Bearish classification
    │   ├── formatters.js       # Price, USD, %, volume, timestamp formatting
    │   ├── spreadMonitor.js    # Bid-ask spread status calculation
    │   ├── feeCalculator.js    # Fee tier lookups and calculations
    │   ├── slippageEstimator.js# Slippage estimation based on order size/liquidity
    │   ├── scalpCircuitBreaker.js # Circuit breaker for scalping
    │   ├── correlationGuard.js # Correlation-based risk checks
    │   └── signalExpiry.js     # Signal expiration management
    │
    ├── strategies/
    │   ├── index.js            # Strategy registry — exports HYDRA as sole strategy
    │   └── hydra/
    │       ├── index.js            # HYDRA entry point: orchestrates scoring → sizing → signal
    │       ├── scoring.js          # Aggregates 5 dimension scores into composite 0-100
    │       ├── sizing.js           # ATR-based position sizing with score multiplier
    │       ├── exitMonitor.js      # Monitors D1+D2+D3 < 40 for immediate exit
    │       ├── selfCalibration.js  # Win-rate-based threshold adjustment (+3/-2)
    │       ├── sessionProfiles.js  # Per-pair UTC hour learning and scoring
    │       └── dimensions/
    │           ├── trendAlignment.js     # D1: Multi-timeframe EMA alignment (0-20)
    │           ├── momentumQuality.js    # D2: RSI shape, MACD, StochRSI, divergence (0-20)
    │           ├── volumeConviction.js   # D3: Volume ratio, OBV trend, flow ratio (0-20)
    │           ├── microstructure.js     # D4: Order book imbalance, spread, VWAP (0-20)
    │           └── sessionIntelligence.js # D5: UTC hour scoring, ATR state (0-20)
    │
    └── components/
        ├── TopBar/             # Logo, regime badge, portfolio stats, mode badge, WS status
        ├── Watchlist/          # Pair list with search, sort, favorites, flash animations
        ├── Chart/              # Custom canvas candlestick chart with indicators
        ├── OrderBook/          # Bid/ask depth visualization with spread
        ├── OrderEntry/         # Buy/Sell form: market/limit, position sizing, live confirm
        ├── Positions/          # Open positions: P&L, SL editing, near-stop flash
        ├── HydraControls/     # HYDRA unified strategy dashboard
        │   ├── index.jsx            # Main HYDRA panel layout
        │   ├── ScoreGauge.jsx       # Circular 0-100 composite score gauge
        │   ├── DimensionBreakdown.jsx # 5 horizontal bars (D1-D5, each 0-20)
        │   ├── ActivityLog.jsx      # Last 8 HYDRA events (signals, calibrations, exits)
        │   ├── SessionHeatmap.jsx   # 24-hour UTC heatmap per pair
        │   └── HydraControls.css    # HYDRA panel styling
        ├── TradeLog/           # Trade history table with PnL, filtering, export
        ├── AIAssistant/        # Collapsible chat with quick prompts
        ├── AlertManager/       # Price/indicator alerts with history
        ├── Backtest/           # Backtest form, progress bar, equity curve, results
        ├── IndicatorPicker/    # Indicator selection and configuration
        │   ├── index.jsx             # Main picker container
        │   ├── IndicatorList.jsx     # Toggle indicators on/off
        │   ├── IndicatorConfig.jsx   # Adjust periods/parameters per indicator
        │   └── PresetManager.jsx     # Save/load indicator presets
        ├── ScalpDashboard/     # Scalping analytics and monitoring
        │   ├── index.jsx             # Dashboard layout
        │   ├── SpreadMonitor.jsx     # Current spread status (green/yellow/red)
        │   ├── TradeFlowBar.jsx      # Buy/sell volume ratio visualization
        │   ├── ScalpAnalytics.jsx    # Win rate, trade velocity analytics
        │   └── FeeImpactCalculator.jsx # Fee drag on scalp trades
        ├── Guide/              # In-app user guide and documentation
        │   ├── index.jsx             # Guide modal container
        │   ├── GuideSidebar.jsx      # Section navigation
        │   ├── GuideContent.jsx      # Guide content renderer
        │   └── GuideSearch.jsx       # Full-text search across guide
        └── Settings/           # Slide-out panel: API keys, risk config, WS status
```

---

## Getting Started

### Prerequisites

- **Node.js** >= 18.0.0
- **npm** >= 9.0.0
- **Coinbase Advanced Trade API key** (CDP format recommended)

### Installation

```bash
git clone <repo-url>
cd cerebro-crypto
npm install
```

### Environment Variables

Copy the template and fill in your credentials:

```bash
cp .env.example .env
```

| Variable | Required | Description |
|----------|----------|-------------|
| `COINBASE_API_KEY` | Yes | Your Coinbase CDP API key (UUID format) |
| `COINBASE_API_SECRET` | Yes | Base64-encoded Ed25519 private key (64 bytes) or PEM-encoded EC key |
| `PORT` | No | Frontend port (default: `3001`) |
| `PROXY_PORT` | No | Proxy server port (default: `3002`) |

### Running the Project

```bash
# Start both proxy server and Vite dev server
npm run dev

# Or start them separately:
npm run server        # Express proxy on port 3002
npx vite --port 3001  # Vite dev server on port 3001
```

Open `http://localhost:3001` in your browser.

### Building for Production

```bash
npm run build     # Creates dist/ folder
npm run preview   # Serve production build locally
```

---

## API Reference

### Proxy Server Endpoints

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/api/health` | Health check — returns `{ status, mode, keyType }` |
| `GET` | `/api/mode` | Get current trading mode (`paper` or `live`) |
| `POST` | `/api/mode` | Set trading mode — body: `{ mode: "paper" \| "live" }` |
| `POST` | `/api/ws-auth` | Generate WebSocket auth credentials — body: `{ channel, product_ids }` |
| `ALL` | `/api/coinbase/*` | Proxy to Coinbase Advanced Trade API with JWT signing |

### Coinbase REST Proxy

All routes are proxied through `/api/coinbase/` to `https://api.coinbase.com/api/v3/brokerage/`:

| Frontend Path | Coinbase Endpoint | Purpose |
|---------------|-------------------|---------|
| `/api/coinbase/products` | `GET /products` | List all trading pairs |
| `/api/coinbase/products/{id}/candles` | `GET /products/{id}/candles` | OHLCV candle data |
| `/api/coinbase/products/{id}/ticker` | `GET /products/{id}/ticker` | Current ticker |
| `/api/coinbase/accounts` | `GET /accounts` | Portfolio balances |
| `/api/coinbase/orders` | `POST /orders` | Place order (paper: simulated, live: forwarded) |
| `/api/coinbase/orders/historical/batch` | `GET /orders/historical/batch` | Order history |
| `/api/coinbase/orders/batch_cancel` | `POST /orders/batch_cancel` | Cancel orders |
| `/api/coinbase/portfolios` | `GET /portfolios` | Named portfolios |
| `/api/coinbase/transaction_summary` | `GET /transaction_summary` | Fee tier info |

### WebSocket Channels

Connected to `wss://advanced-trade-ws.coinbase.com`:

| Channel | Data | Update Rate |
|---------|------|-------------|
| `ticker` | Price, 24h change, volume, bid/ask | Real-time (throttled to 250ms) |
| `candles` | Live candlestick updates | Per candle close |
| `level2` | Order book depth (bids/asks) | Real-time |
| `market_trades` | Recent executed trades | Real-time |
| `user` | Order status updates | On order events |
| `heartbeats` | Connection keep-alive | Every 30 seconds |

---

## Authentication & Security

### JWT Signing (Ed25519 / ES256)

The proxy server auto-detects the API key format and uses the appropriate signing algorithm:

**Ed25519 (EdDSA) — 64-byte base64 key:**
```
Header:  { alg: "EdDSA", typ: "JWT", kid: "<API_KEY>", nonce: "<random>" }
Payload: { iss: "cdp", sub: "<API_KEY>", nbf: <now>, exp: <now+120>, uri: "METHOD api.coinbase.com/path" }
```

**EC P-256 (ES256) — PEM-encoded key:**
```
Header:  { alg: "ES256", typ: "JWT", kid: "<API_KEY>", nonce: "<random>" }
Payload: { iss: "cdp", sub: "<API_KEY>", nbf: <now>, exp: <now+120>, uri: "METHOD api.coinbase.com/path" }
```

### WebSocket Authentication

WebSocket JWTs use the same structure but **omit the `uri` field**:
```
Payload: { iss: "cdp", sub: "<API_KEY>", nbf: <now>, exp: <now+120> }
```

### HMAC Fallback (Legacy)

For 32-byte or unknown key formats, falls back to legacy HMAC-SHA256 headers:
```
CB-ACCESS-KEY: <api_key>
CB-ACCESS-SIGN: HMAC-SHA256(timestamp + method + path + body)
CB-ACCESS-TIMESTAMP: <unix_timestamp>
```

---

## Key Modules & Components

### Store (Zustand)

**File:** `src/store/index.js`

Single global store with localStorage persistence for key settings.

**State slices:**

| Slice | Type | Description |
|-------|------|-------------|
| `wsStatus` | `string` | WebSocket connection state |
| `tradingMode` | `string` | `'paper'` or `'live'` (persisted) |
| `activePair` | `string` | Selected trading pair (persisted) |
| `watchlist` | `string[]` | Tracked pairs (persisted) |
| `favorites` | `string[]` | Quick-access pairs (persisted) |
| `tickers` | `object` | `{ pair: { price, change24h, volume24h, bid, ask } }` |
| `orderBook` | `object` | `{ bids, asks, spread, productId }` |
| `recentTrades` | `array` | Last 20 market trades |
| `candles` | `object` | `{ timeframe: [...candles] }` |
| `activeTimeframe` | `string` | Current chart timeframe |
| `indicators` | `object` | Computed indicator arrays (ema9, rsi, macd, etc.) |
| `currentRegime` | `string` | `'bullish'`, `'choppy'`, or `'bearish'` |
| `regimeHistory` | `array` | Log of regime changes with timestamps |
| `positions` | `array` | Open trading positions |
| `pendingOrders` | `array` | Orders awaiting execution |
| `orderHistory` | `array` | Completed/cancelled orders |
| `portfolio` | `object` | Total value, cash, unrealized P&L, session stats |
| `paperPortfolio` | `object` | Paper balance, positions, trades (persisted) |
| `activeStrategies` | `object` | Enabled strategy configs (persisted) |
| `botRunning` | `boolean` | Whether automated bot is running |
| `signals` | `array` | Strategy signal log |
| `riskSettings` | `object` | Position sizing, SL/TP rules (persisted) |
| `alerts` | `array` | Active alert conditions |
| `chartIndicators` | `object` | UI toggle state for chart indicators |
| `indicatorConfig` | `object` | Per-indicator display settings |
| `hydraScore` | `number` | Current HYDRA composite score (0-100) |
| `hydraDimensions` | `object` | `{ d1, d2, d3, d4, d5 }` — individual dimension scores (each 0-20) |
| `hydraEntryThreshold` | `number` | Current entry threshold (65-95, default 80, self-calibrating) |
| `hydraSettings` | `object` | HYDRA configuration (risk, sizing, exit threshold, signal expiry, etc.) |
| `hydraActivity` | `array` | Last 8 HYDRA events (signals, calibrations, exits) |
| `hydraTradeCount` | `number` | Session trade counter for calibration tracking |

**Key actions:** `updateTicker`, `addCandle`, `setCandles`, `setIndicators`, `setRegime`, `addPosition`, `removePosition`, `updatePosition`, `setPortfolio`, `updatePaperPortfolio`, `updateWatchlist`, `toggleFavorite`, `setRiskSettings`, `toggleStrategy`, `emergencyStopAll`, `addToast`, `setIndicatorConfig`, `setHydraScore`, `setHydraDimensions`, `setHydraEntryThreshold`, `setHydraSettings`, `addHydraActivity`

### Services

**`coinbaseREST.js`** — Axios HTTP client with 15s timeout, auto-unwraps `.data`, routes through proxy. Exposes: `getProducts`, `getProductCandles`, `getProductTicker`, `getAccounts`, `getPortfolios`, `getTransactionsSummary`, `getOrders`, `createOrder`, `cancelOrders`, `getMode`, `setMode`, `getWsAuth`.

**`coinbaseWebSocket.js`** — Singleton WebSocket manager:
- Exponential backoff reconnection: 1s → 2s → 4s → 8s → 16s → 30s
- Auto-resubscribes all channels on reconnect
- Heartbeat keep-alive every 30 seconds
- Subscription routing to registered callbacks
- Channel alias: `l2_data` → `level2`

**`aiService.js`** — AI chat client supporting Claude and OpenAI, with 60s timeout for long responses. Proxied through `/api/ai/chat`.

### Custom Hooks

| Hook | Purpose |
|------|---------|
| `useMarketData` | Orchestrates WS connection + REST candle fetch + indicator worker. Called once in App.jsx. Returns `{loading, error, refreshData}`. |
| `useCoinbaseWebSocket` | WS lifecycle, channel subscriptions (ticker, candles, level2, market_trades, user), message routing to store. Returns `{wsStatus, reconnect}`. |
| `useCoinbaseREST` | REST calls with loading states, IndexedDB candle caching. Returns fetch functions for products, candles, accounts, orders, portfolio. |
| `useOrders` | Order submission with risk validation, paper simulation, limit order timeouts. Returns `{submitOrder, cancelOrder, pendingOrders, orderHistory}`. |
| `usePositions` | Open positions tracking, real-time P&L, auto SL/TP/trailing stop execution every 500ms. Returns `{positions, closePosition, updateStopLoss, updateTakeProfit}`. |
| `usePaperTrading` | Paper balance/positions/trades with localStorage + IndexedDB persistence, equity calculation, account reset. |
| `useBacktest` | Backtest worker management with lazy init, progress tracking (0-100%), result storage. Returns `{running, progress, results, runBacktest, cancelBacktest}`. |
| `useRegimeDetection` | 5-second polling for market regime changes with reason logging. Returns `{regime, reasons, lastUpdate}`. |

### UI Components

| Component | Location | Description |
|-----------|----------|-------------|
| **TopBar** | Header | Logo ("Cerebro Crypto"), regime badge (color-coded), portfolio stats (total value, available, unrealized P&L, session P&L, win rate), paper/live mode badge, WS status dot |
| **Watchlist** | Left sidebar | 18 trading pairs with search, sort by price/change, favorites toggle, green/red price flash animations |
| **OrderBook** | Left sidebar | Bid/ask depth bars with spread display and status coloring |
| **Chart** | Center | Custom HTML5 Canvas candlestick chart with DOM-created canvases (error-isolated from React). Features: pan, zoom, crosshair, OHLCV tooltip, 6 overlay indicators (EMA 9/21/50, SMA 200, BB, VWAP), lower panel with 13 indicators (RSI, MACD, Volume, ATR, ADX, StochRSI, CCI, MFI, OBV, Williams %R, ROC, TRIX, CMF). See [Chart Mechanisms](#chart-mechanisms) for deep-dive. |
| **HydraControls** | Center | HYDRA unified strategy dashboard. ScoreGauge (circular 0-100 composite score with color gradient), DimensionBreakdown (5 horizontal bars for D1-D5, each 0-20), ActivityLog (last 8 HYDRA events — signals, calibrations, exits), SessionHeatmap (24-hour UTC heatmap per pair showing historical performance). Includes HYDRA settings panel for threshold, risk, and calibration configuration. Bearish regime blocks all entries. |
| **OrderEntry** | Right sidebar | Buy/Sell tabs, Market/Limit/Stop-Limit types, USD or crypto quantity input, estimated cost/fees, live mode confirmation modal |
| **Positions** | Right sidebar | Open positions with entry/current price, unrealized P&L ($, %), inline SL editing, near-stop flash animation, close button |
| **TradeLog** | Right sidebar | Virtualized trade history table (react-window FixedSizeList), PnL coloring, winner/loser filtering, CSV/JSON export |
| **AIAssistant** | Right sidebar | Collapsible chat panel with market context injection (pair, price, regime, indicators, positions), message history, quick prompts |
| **Settings** | Slide-out | API key configuration (Claude/OpenAI), risk parameter editing, trading mode toggle, indicator defaults, paper balance reset, WS connection status |
| **Backtest** | Modal (bottom tab) | Strategy selection, starting capital, risk overrides, progress bar with date, results (return, win rate, profit factor, max drawdown), canvas equity curve, trade table |
| **AlertManager** | Modal (bottom tab) | Price alerts (above/below), regime change alerts, order fill notifications, alert history |
| **ScalpDashboard** | Modal (bottom tab) | SpreadMonitor (bid-ask status), TradeFlowBar (buy/sell ratio), ScalpAnalytics (win rate, velocity), FeeImpactCalculator (fee drag analysis) |
| **IndicatorPicker** | Overlay | IndicatorList (toggle on/off), IndicatorConfig (adjust periods/params), PresetManager (save/load presets) |
| **Guide** | Modal (bottom tab) | GuideSidebar (section navigation), GuideContent (rendered guide), GuideSearch (full-text search across guide sections) |

### Web Workers

**`indicators.worker.js`** — Computes: EMA (9, 21, 50), SMA (200), RSI (14), MACD (12, 26, 9), Bollinger Bands (20, 2), ATR (14), ADX (14), VWAP. Also handles regime detection via `REGIME` message type and candle aggregation. All return `(number|null)[]` arrays aligned with candle indices.

**`backtest.worker.js`** — Replays historical candles through strategy logic bar-by-bar, tracks positions and P&L with SL/TP simulation, emits progress updates at regular intervals, returns equity curve, trade list, and performance statistics (totalReturn, winRate, profitFactor, maxDrawdown).

### Utilities

| File | Functions |
|------|-----------|
| `indicators.js` | `calcSMA`, `calcEMA`, `calcRSI`, `calcMACD`, `calcBollingerBands`, `calcATR`, `calcADX`, `calcVWAP`, `findSupportResistance` |
| `riskManager.js` | `validateOrder` (balance, max positions, daily limits, pair cooldown), `calculatePositionSize`, `calculateStopLoss` (percentage or ATR method), `calculateTakeProfit` |
| `paperSimulator.js` | `simulateFill` (applies slippage + fees), `createPaperPosition`, `closePaperPosition` |
| `regimeDetector.js` | `detectRegime` — scoring-based classification using ADX, EMA alignment, RSI, BB width |
| `formatters.js` | `formatPrice`, `formatUSD`, `formatPercent`, `abbreviateNumber`, `formatVolume`, `formatTimestamp`, `formatDate`, `formatDuration`, `formatCryptoAmount`, `getDecimalPlaces` |
| `spreadMonitor.js` | Bid-ask spread status calculation (green < 0.03%, yellow < 0.08%, red) |
| `feeCalculator.js` | Fee tier lookups and calculations per Coinbase fee schedule |
| `slippageEstimator.js` | Slippage estimation based on order size and market liquidity |
| `scalpCircuitBreaker.js` | Circuit breaker that kills scalping during bad market conditions |
| `correlationGuard.js` | Prevents taking correlated pair trades simultaneously |
| `signalExpiry.js` | Expires stale strategy signals after configurable TTL |

---

## Paper Trading

Paper trading provides a risk-free simulation environment with a **$25,000 starting balance**.

**How it works:**
1. When `tradingMode === 'paper'`, the proxy server intercepts `POST /orders` requests
2. Orders are filled instantly at market price +/- 0.05% slippage
3. A 0.6% taker fee is applied to simulate real execution costs
4. Positions are tracked client-side with automatic SL/TP monitoring (every 500ms)

**Features:**
- Simulated fills with realistic slippage and fees
- Position tracking with unrealized P&L
- Automatic stop-loss and take-profit execution
- Trailing stops activated after TP1 hit
- Partial position close at TP1 (50%), remainder at TP2
- Trade history saved to IndexedDB
- Equity calculation (balance + open positions mark-to-market)
- Account reset to starting balance
- localStorage persistence for balance and positions

**Visual indicator:** Paper mode shows yellow borders on all panels; live mode shows red borders.

---

## Indicator Engine

Indicators are computed off-thread in `indicators.worker.js` to prevent UI blocking.

| Indicator | Parameters | Output |
|-----------|-----------|--------|
| **EMA** | Period: 9, 21, 50 | Array of exponential moving averages |
| **SMA** | Period: 200 | Array of simple moving averages |
| **RSI** | Period: 14 | Array of values 0-100 |
| **MACD** | Fast: 12, Slow: 26, Signal: 9 | `{ macd, signal, histogram }` arrays |
| **Bollinger Bands** | Period: 20, StdDev: 2 | `{ upper, middle, lower }` arrays |
| **ATR** | Period: 14 | Array of true range averages |
| **ADX** | Period: 14 | Array of trend strength values 0-100 |
| **VWAP** | Daily reset | Array of volume-weighted average prices |

**Chart rendering:** Overlay indicators (EMA, SMA, BB, VWAP) are drawn on the main candlestick canvas. Oscillators (RSI, MACD) and volume are drawn in a separate lower panel. Users can toggle indicators via the IndicatorPicker and save/load presets.

**HYDRA dependencies:** StochRSI and OBV are included in `ALL_INDICATORS` and computed automatically for HYDRA's dimension scoring (D2: Momentum Quality uses StochRSI; D3: Volume Conviction uses OBV trend). These are always calculated when HYDRA is active, regardless of chart display toggles.

**Extended indicators** (available via IndicatorPicker, computed in worker):

| Indicator | Parameters | Output |
|-----------|-----------|--------|
| **HMA** | Period: 9 | Hull Moving Average (WMA-based, lower lag) |
| **TEMA** | Period: 9 | Triple Exponential Moving Average |
| **Ichimoku** | Tenkan: 9, Kijun: 26, Senkou B: 52 | `{ tenkanSen, kijunSen, senkouA, senkouB, chikou }` |
| **Parabolic SAR** | Step: 0.02, Max: 0.2 | Array of SAR values |
| **Supertrend** | Period: 10, Multiplier: 3 | Array of trend levels |
| **Keltner Channels** | Period: 20, Multiplier: 1.5 | `{ upper, middle, lower }` |
| **Pivot Points** | Standard formula | `{ pp, r1, r2, r3, s1, s2, s3 }` |
| **Stochastic RSI** | RSI: 14, Stoch: 14, K: 3, D: 3 | `{ k, d }` |
| **Williams %R** | Period: 14 | Array of values -100 to 0 |
| **CCI** | Period: 20 | Commodity Channel Index |
| **OBV** | — | On Balance Volume (cumulative) |
| **MFI** | Period: 14 | Money Flow Index (0-100) |
| **CMF** | Period: 20 | Chaikin Money Flow (-1 to 1) |
| **ROC** | Period: 12 | Rate of Change (%) |
| **TRIX** | Period: 15 | Triple-smoothed EMA rate of change |
| **Volume Profile** | Rows: 24 | `{ levels, poc, vaHigh, vaLow }` |

---

## Chart Mechanisms

> Deep-dive into the custom HTML5 Canvas charting engine — architecture, rendering pipeline, interaction model, safety mechanisms, and data flow.

### Chart Architecture Overview

**File:** `src/components/Chart/Chart.jsx` (~490 lines)

The chart is a **custom HTML5 Canvas candlestick renderer** — no third-party charting library is used. It uses a **two-canvas architecture**: a main canvas for candlesticks, overlays, price axis, and crosshair; and a lower canvas for oscillators and volume.

```
┌─────────────────────────────────────────────────────────┐
│  Toolbar                                                │
│  [Pair ▼] [1m 5m 15m 1H 4H 1D 1W] [EMA9 EMA21 ... +]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Main Canvas (DOM-created)                              │
│  ┌─────────────────────────────────────────┬──────────┐ │
│  │  Candlesticks + Wicks                   │ Price    │ │
│  │  Overlay indicators (EMA, SMA, BB, VWAP)│ Axis     │ │
│  │  Volume bars (bottom 18%)               │ (70px)   │ │
│  │  Crosshair + OHLCV tooltip              │          │ │
│  ├─────────────────────────────────────────┴──────────┤ │
│  │  Time Axis (24px)                                  │ │
│  └────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  Lower Tabs: [VOLUME RSI MACD ATR ADX STOCHRSI ...]    │
├─────────────────────────────────────────────────────────┤
│  Lower Canvas (DOM-created, 120px)                      │
│  ┌─────────────────────────────────────────┬──────────┐ │
│  │  Selected indicator visualization       │ Y-Axis   │ │
│  └─────────────────────────────────────────┴──────────┘ │
└─────────────────────────────────────────────────────────┘
```

**Key design decisions:**
- **No third-party chart library** — eliminates dependency on `lightweight-charts` or similar, giving full control over rendering and performance
- **DOM-created canvases** — canvases are created with `document.createElement('canvas')` inside `useEffect`, not as JSX `<canvas>` elements, isolating canvas errors from React's error boundary system
- **`requestAnimationFrame`-based rendering** — all drawing is deferred to rAF callbacks, preventing canvas errors from propagating through React's synchronous render cycle
- **Two separate drawing callbacks** — `drawMainChart` and `drawLowerChart` are independent `useCallback` functions, allowing the lower panel to render even if the main chart encounters issues

### Canvas Creation & Lifecycle

Canvases are created imperatively and live outside React's virtual DOM:

```javascript
// In useEffect (runs once on mount)
const mainCanvas = document.createElement('canvas');
mainCanvas.style.cssText = 'width:100%;height:100%;display:block;cursor:crosshair';
mainContainerRef.current.appendChild(mainCanvas);
mainCanvasRef.current = mainCanvas;

const lowerCanvas = document.createElement('canvas');
lowerCanvas.style.cssText = 'width:100%;height:100%;display:block';
lowerContainerRef.current.appendChild(lowerCanvas);
lowerCanvasRef.current = lowerCanvas;

// Cleanup on unmount
return () => {
  mainCanvasRef.current = null;
  lowerCanvasRef.current = null;
  mc.removeChild(mainCanvas);
  lc.removeChild(lowerCanvas);
};
```

**Why DOM-created instead of JSX?**

When a `<canvas>` is rendered via JSX, any error thrown during canvas operations (e.g., `ctx.scale()`, `ctx.fillRect()`) gets caught by React's error boundary mechanism, which can cascade and unmount the entire component tree. By creating canvases outside React's tree, canvas errors are contained to the drawing callback and cannot trigger error boundaries.

This was a critical fix: previously, a `CanvasRenderingContext2D` `InvalidStateError` in Firefox would crash the entire right sidebar (OrderEntry, Positions, TradeLog, AIAssistant) because the error bubbled up through React's error boundary and unmounted sibling components.

### Safety Mechanisms

#### `safeGetCtx()` — Context Recovery

```javascript
function safeGetCtx(canvas) {
  try {
    if (!canvas || canvas.width <= 0 || canvas.height <= 0) return null;
    const ctx = canvas.getContext('2d');
    if (!ctx) return null;
    ctx.clearRect(0, 0, 1, 1);  // Test: will throw if context is in error state
    return ctx;
  } catch (_e) {
    try {
      // Recovery: reset canvas dimensions to clear error state
      const w = canvas.width, h = canvas.height;
      canvas.width = 0; canvas.height = 0;
      canvas.width = w; canvas.height = h;
      return canvas.getContext('2d');
    } catch (_e2) { return null; }
  }
}
```

The function detects a corrupted canvas context by attempting a small `clearRect`. If it throws (indicating the canvas is in an error state), it resets the canvas dimensions to 0 then back, which clears the GPU-side error state and returns a fresh context.

#### DPR and Dimension Capping

```javascript
const dpr = Math.min(window.devicePixelRatio || 1, 4);
const w = Math.min(Math.round(r.width * dpr), 8192);
const h = Math.min(Math.round(r.height * dpr), 8192);
```

- **DPR cap at 4**: Prevents extreme hi-DPI screens (or errant values) from creating enormous canvas buffers that exceed GPU memory limits
- **8192px dimension cap**: WebGL/Canvas2D implementations typically have a max texture size of 8192 or 16384 pixels. Capping at 8192 avoids silent failures

#### Error Wrapping

Every draw call is wrapped in try-catch at the top level:

```javascript
const drawMainChart = useCallback(() => {
  try {
    // ... all drawing code ...
  } catch (e) { console.warn('[Chart] main draw error:', e); }
}, [dependencies]);
```

And each rAF invocation is also individually wrapped:

```javascript
rafId = requestAnimationFrame(() => {
  try { drawMainChart(); } catch (_e) {}
  try { drawLowerChart(); } catch (_e) {}
});
```

#### Global Error Suppression

In `src/main.jsx`, a global error handler catches canvas errors before they reach React:

```javascript
window.addEventListener('error', (event) => {
  if (event.error && String(event.error).includes('error state')) {
    event.preventDefault();
    return true;
  }
});
```

#### Auto-Recovering Error Boundaries

Both `ErrorBoundary` (in `main.jsx`, 3 retries) and `PanelBoundary` (in `App.jsx`, 5 retries) auto-recover after 1 second, providing a brief "Recovering..." state before re-mounting the failed component.

### Main Chart Drawing Pipeline

The `drawMainChart` callback executes the following steps in order:

```
1. Get context       ──→ safeGetCtx(canvas)
2. Apply DPR         ──→ ctx.scale(dpr, dpr)
3. Calculate view    ──→ visible candle range from offset + candleWidth
4. Find price range  ──→ min/max of visible candles (with 6% padding)
5. Draw grid         ──→ horizontal price lines using niceStep()
6. Draw volume bars  ──→ bottom 18% of chart area, green/red by close vs open
7. Draw candlesticks ──→ wick (line) + body (rect), bullish=#00d4aa, bearish=#ff4560
8. Draw overlays     ──→ EMA, SMA, Bollinger Bands, VWAP lines
9. Draw price axis   ──→ right-side 70px panel with formatted prices
10. Draw current px  ──→ colored label at last candle's close price
11. Draw time axis   ──→ bottom 24px with formatted timestamps
12. Draw crosshair   ──→ dashed crosshair lines + OHLCV info box
```

**Coordinate System:**

| Constant | Value | Purpose |
|----------|-------|---------|
| `PRICE_AXIS_WIDTH` | 70px | Width of right-side price axis panel |
| `TIME_AXIS_HEIGHT` | 24px | Height of bottom time axis |
| `VOLUME_HEIGHT_RATIO` | 0.18 | Volume bars occupy bottom 18% of chart area |
| `CANDLE_GAP` | 2px | Gap between adjacent candle bodies |

**Price-to-Y conversion:**
```javascript
const priceToY = (p) => priceH * (1 - (p - priceMin) / finalPriceRange);
```

Where `priceH` = `chartH - volumeH`, and the visible price range includes 6% padding above and below.

**Grid lines** use the `niceStep()` function to compute human-readable price intervals (multiples of 1, 2, 5, or 10).

### Lower Indicator Panel

The lower panel renders one indicator at a time, selected via tab buttons. Supported indicators:

`volume` | `rsi` | `macd` | `atr` | `adx` | `stochRsi` | `cci` | `mfi` | `obv` | `williamsR` | `roc` | `trix` | `cmf`

**Rendering by indicator type:**

| Indicator | Rendering |
|-----------|-----------|
| **Volume** | Vertical bars, green (bullish) / red (bearish), 50% opacity. Y-axis: 0 to max volume. |
| **RSI** | Line chart 0-100. Dashed reference lines at 30, 50, 70. Color: `#6c63ff` (accent). |
| **MACD** | Three layers: histogram bars (green/red, 40% opacity), MACD line (blue `#2196F3`), signal line (orange `#FF9800`). Auto-scaled Y-axis. |
| **ATR** | Line chart, auto-scaled. Color: orange `#FF9800`. |
| **Generic** | Line chart, auto-scaled min/max. Color: purple `#9C27B0`. Applies to: ADX, StochRSI, CCI, MFI, OBV, Williams %R, ROC, TRIX, CMF. |

Each lower indicator has its own Y-axis drawn in the 70px right panel, matching the main chart's axis width.

### View State & Interaction

View state is stored in a mutable `useRef` (not React state) to avoid re-renders during interaction:

```javascript
const viewRef = useRef({
  offset: 0,          // candles scrolled from right edge
  candleWidth: 8,     // pixel width of each candle body
  isDragging: false,   // whether mouse is held down for pan
  dragStartX: 0,       // mouse X at drag start
  dragStartOffset: 0   // offset at drag start
});
```

**Interactions:**

| Action | Behavior |
|--------|----------|
| **Mouse wheel** | Zoom: adjusts `candleWidth` (2-40px range). Preserves focal point under cursor. |
| **Mouse drag** | Pan: adjusts `offset` based on pixel distance / candle width. |
| **Mouse hover** | Crosshair: dashed accent-colored lines + OHLCV info box in upper-left corner. |
| **Mouse leave** | Clears crosshair, resets cursor to `crosshair`. |

**Zoom focal-point preservation:**

When zooming, the candle under the cursor stays in the same screen position. This is achieved by:
1. Recording which candle index is under the cursor before zoom
2. Computing new visible range after candle width change
3. Adjusting offset so the same candle index appears at the same fractional position

**Event listener setup** is deferred 100ms via `setTimeout` to ensure the DOM canvas is fully laid out before attaching handlers. All listeners are cleaned up on unmount via a `_cleanup` function stored on the canvas element.

### Data Flow: WebSocket to Pixels

```
┌────────────┐    ┌──────────────────┐    ┌───────────┐
│ Coinbase WS │───→│ useCoinbaseWS    │───→│  Zustand   │
│ (ticker,    │    │ hook routes      │    │  Store     │
│  candles)   │    │ messages to      │    │            │
└────────────┘    │ store actions     │    │ candles[]  │
                  └──────────────────┘    │ indicators │
                                          └─────┬──┬──┘
┌────────────┐    ┌──────────────────┐          │  │
│ Coinbase   │───→│ useCoinbaseREST  │──────────┘  │
│ REST API   │    │ fetchCandles()   │              │
└────────────┘    └──────────────────┘              │
                                                    │
                  ┌──────────────────┐              │
                  │  useMarketData   │──────────────┘
                  │  (orchestrator)  │
                  │                  │
                  │  1. fetchCandles │
                  │  2. subscribe WS │
                  │  3. post to      │
                  │     worker on    │
                  │     candle change│
                  └────────┬─────────┘
                           │
                           ▼
                  ┌──────────────────┐
                  │ indicators       │
                  │ .worker.js       │
                  │                  │
                  │ CALCULATE msg →  │
                  │ EMA, RSI, MACD,  │
                  │ BB, ATR, ADX,    │
                  │ VWAP, ...        │
                  │                  │
                  │ RESULT msg →     │
                  │ store.setIndicators()
                  └──────────────────┘
                           │
                           ▼
                  ┌──────────────────┐
                  │ Chart Component  │
                  │                  │
                  │ reads:           │
                  │ • candles[tf]    │
                  │ • indicators.*   │
                  │ • chartIndicators│
                  │   (toggle state) │
                  │                  │
                  │ draws via rAF    │
                  └──────────────────┘
```

**Step-by-step:**

1. **`useMarketData`** (called once in `App.jsx`) fetches 300 candles via REST and starts the WebSocket
2. Candle data is stored in `store.candles[activeTimeframe]`
3. `useMarketData` subscribes to store changes — when `candles` object reference changes, it posts a `CALCULATE` message to the indicator worker
4. The worker computes all requested indicators off-thread and posts back a `RESULT` message
5. Results are merged into `store.indicators` (e.g., `indicators.ema9`, `indicators.rsi`, `indicators.macd`)
6. The Chart component reads `candles[activeTimeframe]`, `indicators`, and `chartIndicators` (toggle state) via `useStore` selectors
7. When any of these values change, `drawMainChart` / `drawLowerChart` (memoized via `useCallback`) are recreated
8. A `useEffect` watching these callbacks triggers a `requestAnimationFrame` to redraw

**WebSocket live updates:**
- The `candles` WebSocket channel pushes live candle updates that are merged into the store
- This triggers the indicator worker recalculation, which triggers a chart redraw
- The entire cycle (WS message → store → worker → store → chart redraw) typically completes in < 100ms

### Resize Handling

```javascript
useEffect(() => {
  const sizeAndDraw = () => {
    // 1. Measure container via getBoundingClientRect
    // 2. Set canvas.width/height = container size * DPR (capped at 8192)
    // 3. Schedule rAF draw
  };

  const t = setTimeout(sizeAndDraw, 50);        // Initial draw deferred 50ms
  const ro = new ResizeObserver(sizeAndDraw);    // Subsequent resizes
  ro.observe(mainContainerRef.current);
  ro.observe(lowerContainerRef.current);

  return () => { clearTimeout(t); cancelAnimationFrame(rafId); ro.disconnect(); };
}, [drawMainChart, drawLowerChart]);
```

- **Initial 50ms delay**: Ensures the container has been laid out by CSS Grid before measuring dimensions
- **ResizeObserver**: Automatically redraws when the browser window resizes or panel layout changes
- **Canvas backing store**: The CSS size is always `100%` of the container, while `canvas.width/height` (the backing store) is set to `containerSize * DPR` for crisp rendering on hi-DPI displays

### Indicator Overlay System

**Toolbar pills** (quick toggles):

| Pill | Key | Color | Style |
|------|-----|-------|-------|
| EMA 9 | `ema9` | `#2196F3` (blue) | Solid |
| EMA 21 | `ema21` | `#FF9800` (orange) | Solid |
| EMA 50 | `ema50` | `#9C27B0` (purple) | Solid |
| SMA 200 | `sma200` | `#FFFFFF` (white) | Dashed |
| BB | `bbands` | `rgba(136,136,170,0.6)` | Upper/Lower solid, middle dashed |
| VWAP | `vwap` | `#f0b429` (yellow) | Dashed |

**Toggle state** is stored in `store.chartIndicators` (e.g., `{ ema9: true, bbands: false, ... }`). Toggling a pill calls `setChartIndicators({ [key]: !chartIndicators[key] })`, which triggers a `drawMainChart` recreation via `useCallback` dependency.

**Drawing overlay lines:**
```javascript
const drawLine = (dataArr, color, dashed) => {
  ctx.strokeStyle = color;
  ctx.setLineDash(dashed ? [4, 3] : []);
  ctx.beginPath();
  for (let i = 0; i < visible.length; i++) {
    const ts = visible[i].timestamp;
    const pt = dataArr.find((d) => d.time === ts || d.time === ts / 1000);
    if (pt && pt.value != null) {
      // ... moveTo or lineTo at priceToY(pt.value)
    }
  }
  ctx.stroke();
};
```

Indicator data arrays use `{ time, value }` objects. The `find()` matches by timestamp (handling both seconds and milliseconds).

**IndicatorPicker** (advanced):
- Opens as an overlay panel with three tabs: Indicators, Configure, Presets
- `IndicatorList` — toggle any of the 27 available indicators on/off
- `IndicatorConfig` — adjust period, multiplier, and display settings per indicator
- `PresetManager` — save/load named indicator presets to localStorage

### Formatting Functions

The chart uses three formatters from `src/utils/formatters.js`:

| Function | Purpose | Example |
|----------|---------|---------|
| `formatPrice(price, pair)` | Pair-specific decimal places | `formatPrice(67234.5, 'BTC-USD')` → `"67,234.50"` |
| `formatTimestamp(ts)` | HH:MM:SS | `formatTimestamp(1708300800000)` → `"14:00:00"` |
| `abbreviateNumber(num)` | Compact volume display | `abbreviateNumber(1234567)` → `"1.23M"` |

**Decimal place lookup** (`DECIMAL_MAP`):

| Pair | Decimals | Pair | Decimals |
|------|----------|------|----------|
| BTC-USD | 2 | DOGE-USD | 5 |
| ETH-USD | 2 | SHIB-USD | 8 |
| SOL-USD | 2 | XRP-USD | 4 |
| Default | 4 | — | — |

### Chart CSS Layout

**File:** `src/components/Chart/Chart.css`

```
.chart-container      flex column, 100% height, overflow hidden
├── .chart-toolbar    flex row, gap 8px, wraps, border-bottom
│   ├── .chart-pair-selector     dropdown, 12px font
│   ├── .chart-tf-group          flex row, gap 2px
│   │   └── .chart-tf-btn        11px, accent bg when active
│   └── .chart-indicator-pills   flex row, gap 4px, margin-left auto
│       └── .chart-indicator-pill  10px, rounded 10px, accent border when active
├── .chart-main-area  flex: 1, min-height: 0, position relative
├── .chart-lower-panel  flex-shrink: 0, border-top
│   ├── .chart-lower-tabs  flex row, 10px uppercase tabs
│   └── .chart-lower-canvas-wrap  height: 120px, position relative
```

### Known Issue: recentTrades Ticker

The chart previously included a scrolling trade ticker at the bottom that displayed the last 20 WebSocket market trades. This feature was **removed** because rendering trade items with `formatPrice()` and `formatTimestamp()` caused a crash that propagated through React's error boundary and unmounted the entire right sidebar.

**Root cause analysis:**
- The `recentTrades` array updates on every WebSocket `market_trades` message (potentially multiple times per second)
- Each update triggered a re-render of the Chart component
- The combination of rapid re-renders + formatter calls on trade data caused an `InvalidStateError` on the canvas context
- The exact mechanism is unclear — the formatters handle null/NaN safely in isolation, but the high-frequency re-rendering appeared to create a race condition with canvas operations

**Resolution:** The recentTrades ticker was removed from Chart.jsx. The CSS styles for `.chart-trades-ticker`, `.chart-trade-item`, etc. remain in Chart.css but are unused. Trade data is still available in the Zustand store (`store.recentTrades`) and could be rendered in a separate non-canvas component if needed.

---

## Strategy & Regime Detection

### Market Regimes

The regime detector classifies market conditions every 5 seconds:

| Regime | Criteria | Color |
|--------|----------|-------|
| **Bullish** | Price > SMA200, EMA stack aligned (9>21>50), ADX > 25, RSI 45-75 | `#00d4aa` (teal) |
| **Choppy** | ADX < 20, or price near SMA200 (±1.5%) with narrow Bollinger Bands | `#f0b429` (yellow) |
| **Bearish** | Price < SMA200, EMA9 < EMA21, ADX > 25 | `#ff4560` (red) |

**Bearish regime** blocks all HYDRA entries as a capital preservation mechanism (regime override).

### HYDRA Unified Strategy Engine

HYDRA (Hybrid Unified Dynamic Risk Analyzer) replaces all 8 previous strategies (cryptoMomentum, breakout, vwapReclaim, meanReversion, rangeScalp, microVwapScalp, momentumSpikeScalp, orderBookImbalanceScalp) with a single **5-dimensional confluence scoring** system that produces a composite score from 0-100.

**Architecture:** `src/strategies/hydra/`

```
hydra/
├── index.js              Orchestrator: runs all 5 dimensions → composite score → signal decision
├── scoring.js            Aggregates dimension scores, applies session weight
├── sizing.js             ATR-based position sizing with score-based multiplier
├── exitMonitor.js        Monitors open positions for exit conditions
├── selfCalibration.js    Adjusts entry threshold based on rolling win rate
├── sessionProfiles.js    Per-pair UTC hour learning and scoring
└── dimensions/
    ├── trendAlignment.js       D1: Multi-Timeframe Trend Alignment
    ├── momentumQuality.js      D2: Momentum Quality
    ├── volumeConviction.js     D3: Volume Conviction
    ├── microstructure.js       D4: Market Microstructure
    └── sessionIntelligence.js  D5: Session Intelligence
```

#### 5-Dimensional Confluence Scoring

Each dimension scores 0-20. The composite score is the sum of all five (0-100).

| Dimension | Score | Inputs | What It Measures |
|-----------|-------|--------|------------------|
| **D1: Multi-Timeframe Trend Alignment** | 0-20 | EMA alignment across 1m, 5m, 15m timeframes | Whether short, medium, and long trends agree on direction |
| **D2: Momentum Quality** | 0-20 | RSI shape, MACD structure, StochRSI, hidden bullish divergence | Strength and quality of current momentum |
| **D3: Volume Conviction** | 0-20 | Raw volume vs average, OBV trend, buy/sell flow ratio | Whether volume supports the move |
| **D4: Market Microstructure** | 0-20 | Order book imbalance, spread quality, VWAP location | Real-time market structure health |
| **D5: Session Intelligence** | 0-20 | Per-pair UTC hour scoring, ATR volatility state | Historical performance of this pair at this time of day |

#### Entry Logic

- **Entry threshold**: Score >= 80 required (configurable 65-95)
- **Regime override**: No entries during bearish regime regardless of score
- **Spread block**: Spread > 0.10% blocks entry regardless of score
- **Signal expiry**: Signals expire after 20 seconds (configurable 5-60s) if not acted upon

#### Exit Logic

- **Exit score monitor**: If D1 + D2 + D3 drops below 40 (configurable 20-60), the position is closed immediately
- **Dynamic ATR-based targets**:
  - TP1 = ATR x 1.2
  - TP2 = ATR x 2.5
  - Stop-loss = ATR x 1.5
  - Trailing stop = ATR x 0.8 (activated after TP1 hit)
- **Consecutive loss pause**: After 3 consecutive losses (configurable 1-5), pauses new entries

#### Self-Calibrating Threshold

HYDRA automatically adjusts its entry threshold based on rolling performance over 20 trades:
- Win rate < 40% over last 20 trades → raise threshold by +3 (more selective)
- Win rate > 70% over last 20 trades → lower threshold by -2 (capture more opportunities)
- Threshold is clamped to the 65-95 range
- Can be toggled off for manual threshold control

#### Session Learning

HYDRA builds per-pair UTC hour profiles that track historical performance by time of day:
- Each pair maintains a 24-slot array (one per UTC hour)
- Wins and losses at each hour update the profile score
- D5 (Session Intelligence) uses these profiles to boost or penalize the composite score
- Session weight is configurable (0.5x - 2.0x, default 1.0x)

#### HYDRA Settings

| Setting | Range | Default | Description |
|---------|-------|---------|-------------|
| Entry Score Threshold | 65-95 | 80 | Minimum composite score to enter a trade |
| Risk Per Trade | 0.25%-3% | 1% | Portfolio risk per trade |
| Max Position Size | 2%-15% | 8% | Maximum position size as % of portfolio |
| Exit Score Threshold | 20-60 | 40 | D1+D2+D3 below this triggers immediate exit |
| Signal Expiry | 5-60s | 20s | Time before an unacted signal expires |
| Auto-Calibrate Threshold | on/off | ON | Self-adjusting entry threshold based on win rate |
| Consecutive Loss Pause | 1-5 | 3 | Number of consecutive losses before pausing entries |
| Session Score Weight | 0.5-2.0 | 1.0 | Multiplier for D5 (Session Intelligence) contribution |

---

## Risk Management

All orders are validated against configurable risk limits:

| Setting | Default | Description |
|---------|---------|-------------|
| `positionSizePct` | 5% | Portfolio percentage per position |
| `stopLossMethod` | `percentage` | `'percentage'` or `'atr'` |
| `stopLossPct` | 2% | Stop-loss distance from entry |
| `tp1R` | 1.5 | First take-profit risk:reward ratio |
| `tp2R` | 3.0 | Second take-profit risk:reward ratio |
| `trailingStopATR` | 1 | ATR multiplier for trailing stop |
| `maxPositions` | 3 | Maximum concurrent open positions |
| `maxDailyLossUSD` | $500 | Maximum daily loss before lockout |
| `maxTradesPerDay` | 10 | Maximum trades per day |
| `pairCooldownMinutes` | 10 min | Cooldown between same-pair trades |

**SL/TP execution flow:**
1. **Stop-loss** triggers if price breaches SL level → immediate market close
2. **TP1** (1.5R): Closes 50% of position, moves SL to break-even, activates trailing stop
3. **TP2** (3R): Closes remaining position
4. **Trailing stop**: After TP1, SL moves up with price minus trailing distance

**Pre-order validation checks:**
- Sufficient balance for order
- Max concurrent positions not exceeded
- Daily trade count limit
- Daily loss limit
- Pair cooldown period (prevents same-pair overtrading)
- Position size within percentage limit

### HYDRA ATR-Based Position Sizing

HYDRA uses its own dynamic position sizing pipeline in `src/strategies/hydra/sizing.js`, layered on top of the existing risk validation:

**Position size formula:**
```
positionSize = baseRisk / (stopDistance / entryPrice)
```

Where:
- `baseRisk` = portfolio value x risk per trade (default 1%)
- `stopDistance` = ATR x 1.5 (dynamic stop-loss distance)
- `entryPrice` = current market price at signal time

**Score-based multiplier:** The raw position size is scaled by the HYDRA composite score:

| Score Range | Multiplier | Rationale |
|-------------|------------|-----------|
| 80-84 | 0.75x | Minimum-confidence entry, conservative size |
| 85-89 | 1.0x | Standard-confidence entry, full size |
| 90-94 | 1.25x | High-confidence entry, increased size |
| 95-100 | 1.5x | Maximum-confidence entry, aggressive size |

The final position size is capped at `maxPositionSize` (default 8% of portfolio).

**Dynamic targets (ATR-based):**

| Target | ATR Multiplier | Description |
|--------|---------------|-------------|
| TP1 | ATR x 1.2 | First take-profit — closes 50%, moves SL to break-even |
| TP2 | ATR x 2.5 | Second take-profit — closes remaining position |
| Stop-loss | ATR x 1.5 | Initial stop-loss distance |
| Trailing stop | ATR x 0.8 | Activated after TP1 hit, trails price |

---

## Backtesting

The backtesting engine runs in a Web Worker to prevent UI freezing.

**Process:**
1. User selects strategy, date range, and starting capital
2. Historical candles are fetched and sent to `backtest.worker.js`
3. Worker calculates all indicators for the candle series
4. Worker replays candles bar-by-bar through strategy checkEntry/checkExit
5. For each bar: checks entry conditions, monitors open positions for SL/TP
6. Progress updates stream back to the UI (progress bar with current date)
7. Results include: trade list, equity curve, performance statistics

**Results displayed:**
- Total return (% and $)
- Win rate (%)
- Profit factor (gross profits / gross losses)
- Max drawdown (peak to trough %)
- Average trade duration
- Canvas-based equity curve chart
- Individual trade table with entry/exit details
- CSV export option

---

## Scalp Dashboard

The ScalpDashboard is a dedicated analytics panel for scalping strategies, accessible via the bottom tab bar.

**Sub-components:**

| Component | Purpose |
|-----------|---------|
| **SpreadMonitor** | Displays current bid-ask spread with color coding: green (< 0.03%), yellow (< 0.08%), red (>= 0.08%). Updated from level2 WebSocket data every 2s. |
| **TradeFlowBar** | Visualizes the buy/sell volume ratio from a 60-second rolling window of market trades. Ratio > 1 = buyer dominance, < 1 = seller dominance. |
| **ScalpAnalytics** | Session statistics: win rate, trade velocity, streak tracking, cumulative P&L. |
| **FeeImpactCalculator** | Calculates fee drag on scalp trades given entry/exit prices and quantities. Helps determine minimum move required for profitability. |

**Supporting utilities:**
- `spreadMonitor.js` — Calculates spread status thresholds
- `feeCalculator.js` — Fee tier lookups per Coinbase schedule
- `slippageEstimator.js` — Estimates slippage from order size and book depth
- `scalpCircuitBreaker.js` — Automatically disables scalping during high-spread or low-liquidity conditions
- `correlationGuard.js` — Prevents taking simultaneous positions in correlated pairs

---

## Database & Persistence

### IndexedDB (`cerebro-crypto` database, v2)

| Store | Key | Indices | Purpose |
|-------|-----|---------|---------|
| `trades` | `id` | pair, timestamp, strategy | Live and backtest trades |
| `candles` | auto-increment | pairTimeframe, timestamp | OHLCV cache per pair/timeframe |
| `paperTrades` | `id` | pair, timestamp | Paper trading trade records |
| `alerts` | `id` | pair, type | Alert conditions |
| `signals` | `id` | pair, timestamp, strategy | HYDRA signal records with dimension scores |
| `strategyPerformance` | `id` | strategy, pair | Per-strategy performance metrics for calibration |

**API:** `initDB`, `saveTrade`, `getTrades`, `saveCandles`, `getCandles`, `clearCandleCache`, `savePaperTrade`, `getPaperTrades`, `exportTradesCSV`, `exportTradesJSON`

**Candle caching strategy:**
1. On pair/timeframe switch, check IndexedDB first
2. If cache hit: return cached data immediately, fetch fresh in background
3. If cache miss: fetch from REST API, save to IndexedDB

### localStorage

| Key | Persisted Data |
|-----|---------------|
| `tradingMode` | `'paper'` or `'live'` |
| `activePair` | Currently selected pair (e.g., `'BTC-USD'`) |
| `watchlist` | Array of tracked pairs |
| `favorites` | Array of favorited pairs |
| `paperPortfolio` | `{ balance, positions, trades }` |
| `activeStrategies` | Strategy toggle states |
| `riskSettings` | Position sizing and risk limits |
| `indicatorConfig` | Per-indicator display settings |
| `indicatorPresets` | Saved indicator preset configurations |
| `hydra_entry_threshold` | Current HYDRA entry threshold (self-calibrating) |
| `hydra_settings` | HYDRA configuration (risk, sizing, exit threshold, etc.) |
| `hydra_session_profiles` | Per-pair UTC hour performance profiles |
| `hydra_threshold` | Last-used manual threshold override |
| `hydra_calibration_history` | Rolling calibration adjustments log |

---

## Configuration

### `vite.config.js`

```javascript
export default defineConfig({
  plugins: [react()],
  server: {
    port: 3001,
    proxy: { '/api': { target: 'http://localhost:3002', changeOrigin: true } },
  },
});
```

### `src/config/constants.js`

| Constant | Value | Description |
|----------|-------|-------------|
| `APP_VERSION` | `'0.2.0'` | Application version |
| `DEFAULT_PAIRS` | 18 pairs | BTC-USD, ETH-USD, SOL-USD ... ARB-USD |
| `TIMEFRAMES` | 7 entries | 1m, 5m, 15m, 1H, 4H, 1D, 1W |
| `WS_URL` | `wss://advanced-trade-ws.coinbase.com` | WebSocket endpoint |
| `PAPER_STARTING_BALANCE` | `25000` | Paper trading initial balance |
| `SLIPPAGE_PCT` | `0.05` | Simulated slippage (0.05%) |
| `TAKER_FEE_PCT` | `0.6` | Simulated taker fee (0.6%) |
| `RENDER_THROTTLE_MS` | `250` | Ticker update throttle |
| `WS_RECONNECT_DELAYS` | `[1, 2, 4, 8, 16, 30]s` | Exponential backoff delays |
| `RISK_DEFAULTS` | object | Default risk settings (see Risk Management) |
| `COLORS` | object | Application color palette |
| `REGIMES` | object | `BULLISH`, `CHOPPY`, `BEARISH` |
| `STRATEGIES` | object | Single entry: `HYDRA` unified strategy |
| `TIMEFRAME_MS` | object | Timeframe durations in milliseconds |
| `FEE_TIERS` | object | Coinbase fee tiers (starter, advanced, etc.) |

### `src/config/indicatorDefaults.js`

Default periods and display colors for all indicators. Used by the IndicatorPicker for initial configuration.

### `src/config/tickerProfiles.js`

Per-pair configuration including decimal places, minimum order sizes, and display precision.

---

## Color Palette & Theming

The application uses a dark theme with CSS custom properties defined in `src/index.css`:

| Variable | Hex | Usage |
|----------|-----|-------|
| `--bg` | `#0a0a0f` | Main background |
| `--card-surface` | `#12121a` | Card/panel backgrounds |
| `--border` | `#1e1e2e` | Borders and dividers |
| `--accent` | `#6c63ff` | Buttons, active states, links |
| `--bullish` | `#00d4aa` | Gains, uptrends, buy signals |
| `--bearish` | `#ff4560` | Losses, downtrends, sell signals |
| `--text-primary` | `#e2e2e2` | Main text |
| `--text-secondary` | `#8888aa` | Muted/secondary text |
| `--warning-yellow` | `#f0b429` | Paper mode, choppy regime |

**Trading mode borders:**
- Paper mode: `rgba(240, 180, 41, 0.3)` — subtle yellow
- Live mode: `rgba(255, 69, 96, 0.35)` — subtle red

**Layout:** 3-column CSS Grid (`280px | 1fr | 320px`) with responsive stacking below 1200px.

**Typography:** Inter font (Google Fonts), weights 400-800, monospace `'Courier New'` for numeric values.

**Animations:**
- `fadeIn` — opacity transition (0.15s)
- `slideUp` — vertical translation + fade (0.2s)
- `settings-slide-in` — horizontal slide from right (0.2s)
- `ws-pulse` — opacity pulse for reconnecting state (1.5s infinite)
- `wl-flash-green` / `wl-flash-red` — price change flash (0.6s)
- `pos-flash-red` — near-stop position warning (1s infinite)

---

## Dependency Graph

| Package | Purpose |
|---------|---------|
| **react** / **react-dom** | UI framework and DOM rendering |
| **vite** / **@vitejs/plugin-react** | Build tooling, HMR, and JSX transformation |
| **zustand** | Lightweight state management (~3KB) with subscribe/persist |
| **axios** | HTTP client for proxied API calls with interceptors |
| **react-window** | Virtualized rendering for large trade history lists |
| **idb** | Promise-based IndexedDB wrapper for candle caching and trade persistence |
| **express** | HTTP server framework for API proxy |
| **cors** | Cross-origin middleware for Express |
| **ws** | WebSocket client for Coinbase real-time data stream |
| **jsonwebtoken** | JWT library (actual signing uses `node:crypto` Ed25519) |
| **dotenv** | Environment variable loading from `.env` files |
| **concurrently** | Runs proxy server + Vite dev server in parallel |

---

## Security Notes

- API keys are stored server-side in `.env` — **never exposed to the browser**
- All Coinbase API requests are proxied through Express with JWT signing
- The `.env` file is listed in `.gitignore` — credentials are not versioned
- Paper trading orders are intercepted server-side and never reach Coinbase
- Live mode requires explicit confirmation modal (type "LIVE TRADING") before order submission
- WebSocket authentication tokens have 120-second expiry with random nonce
- No hardcoded credentials exist in the source code
- The `.env.example` file contains placeholder values only
- JWT nonce provides replay attack protection

---

## TODOs & Known Issues

No `TODO`, `FIXME`, `HACK`, or `XXX` comments were found in the source code.

**Known limitations:**
- No TypeScript — the project uses vanilla JavaScript with JSX
- No test framework configured (no Jest, Vitest, or Playwright)
- No ESLint or Prettier configuration
- No CI/CD pipeline or Docker configuration
- The `jsonwebtoken` package is a dependency but actual JWT signing uses `node:crypto` directly
- Coinbase does not natively support 4H timeframe; it is mapped to 6H
- Weekly candles are assembled client-side from daily data
- No short-selling support (Coinbase spot trading only)

---

## Troubleshooting

**Blank page / no data:**
- Ensure both servers are running (`npm run dev` starts both)
- Check browser console for WebSocket connection errors
- Verify `.env` has valid API credentials

**Auth failures (401):**
- Check that your API key format matches expectations (64-byte base64 for Ed25519)
- Look at proxy console for `[proxy] AUTH FAILED` messages
- Ensure the key has Advanced Trade permissions on Coinbase

**Port conflicts (EADDRINUSE):**
- Kill existing Node processes: `taskkill /F /IM node.exe` (Windows) or `pkill node` (Unix)
- Check if ports 3001/3002 are in use: `netstat -ano | findstr :3002`

**WebSocket disconnections:**
- The app auto-reconnects with exponential backoff (1s to 30s max)
- Check the WS status indicator in the TopBar
- If persistent, verify network/firewall settings

**Chart not rendering:**
- Ensure candle data is loaded (check Network tab for candle API calls)
- Chart requires at least 1 candle to render
- Check browser console for canvas-related errors
- If you see `InvalidStateError: CanvasRenderingContext2D.scale`, the `safeGetCtx()` function should auto-recover by resetting canvas dimensions
- If the entire right sidebar disappears, this indicates a canvas error escaped isolation — check that canvases are DOM-created (not JSX) and all drawing is inside try-catch

**Paper trading balance not updating:**
- Check localStorage for `cerebro-paper-balance` key
- Try resetting the paper account from Settings

---

## Changelog

### v1.0.3 (2026-02-20)
- **HYDRA unified strategy engine**: Replaced all 8 individual strategies (cryptoMomentum, breakout, vwapReclaim, meanReversion, rangeScalp, microVwapScalp, momentumSpikeScalp, orderBookImbalanceScalp) with a single 5-dimensional confluence scoring system
- Added 5 scoring dimensions: Multi-Timeframe Trend Alignment, Momentum Quality, Volume Conviction, Market Microstructure, Session Intelligence
- Added self-calibrating entry threshold that adjusts based on rolling win rate
- Added ATR-based dynamic position sizing with score-based multiplier (0.75x-1.5x)
- Added dynamic ATR-based targets: TP1=ATR x 1.2, TP2=ATR x 2.5, Stop=ATR x 1.5, Trail=ATR x 0.8
- Added exit score monitor (D1+D2+D3 < 40 triggers immediate close)
- Added per-pair UTC hour session learning and scoring profiles
- Added spread block (>0.10% blocks regardless of score)
- Added HydraControls UI: ScoreGauge, DimensionBreakdown, ActivityLog, SessionHeatmap
- Upgraded IndexedDB to v2 with signals and strategyPerformance stores
- Added StochRSI and OBV to ALL_INDICATORS for HYDRA dimension scoring
- Added HYDRA localStorage keys: hydra_entry_threshold, hydra_settings, hydra_session_profiles, hydra_threshold, hydra_calibration_history
- Added Zustand slices: hydraScore, hydraDimensions, hydraEntryThreshold, hydraSettings, hydraActivity, hydraTradeCount
- Removed StrategyControls component (replaced by HydraControls)
- Strategy count: 8 → 1 (HYDRA)

### v1.0.2 (2026-02-19)
- **Chart rewrite**: Rebuilt Chart.jsx with DOM-created canvases for error isolation from React
- Added `safeGetCtx()` canvas context recovery mechanism
- Added DPR cap (4x) and canvas dimension cap (8192px)
- Added auto-recovering PanelBoundary (5 retries) for all sidebar panels
- Added auto-recovering ErrorBoundary (3 retries) in main.jsx
- Added global canvas error suppression handler
- Removed recentTrades ticker from Chart (caused crashes via high-frequency re-renders)
- Added 17 new indicators to worker: HMA, TEMA, Ichimoku, Parabolic SAR, Supertrend, Keltner, Pivot Points, StochRSI, Williams %R, CCI, OBV, MFI, CMF, ROC, TRIX, Volume Profile, candle aggregation
- Added comprehensive Chart Mechanisms documentation section

### v1.0.1 (2026-02-19)
- Added 3 new scalping strategies: Micro VWAP Scalp, Momentum Spike Scalp, Order Book Imbalance Scalp
- Added ScalpDashboard with SpreadMonitor, TradeFlowBar, ScalpAnalytics, FeeImpactCalculator
- Added IndicatorPicker with preset management
- Added in-app User Guide with search functionality
- Added StrategyCard, BotMasterControls, ScalpSessionScorecard sub-components
- Added scalping utilities: spreadMonitor, feeCalculator, slippageEstimator, scalpCircuitBreaker, correlationGuard, signalExpiry
- Added tickerProfiles and indicatorDefaults config files
- Strategy count: 5 → 8

### v1.0.0 (2026-02-18)
- Initial release
- Custom HTML5 Canvas chart (replaced lightweight-charts dependency)
- Ed25519 JWT authentication for Coinbase Advanced Trade API
- Paper trading with $25,000 simulated balance
- 10 technical indicators computed via Web Workers
- Market regime detection (Bullish / Choppy / Bearish)
- 5 built-in trading strategies
- Backtesting engine with equity curve
- AI Assistant integration (Claude / OpenAI)
- Alert system for price and indicator conditions
- IndexedDB caching for candle data
- Trade log with CSV/JSON export
- Responsive 3-column layout with dark theme

---

*Generated by DoogieHowser documentation agent on 2026-02-20*
